<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>All News - ABC Chemical</title>
    <meta name="description" content="All news and updates from ABC Chemical Co., Ltd." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/tailwind.css">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter','ui-sans-serif','system-ui','Arial'] },
            colors: { brand: { blue: '#0E3C75', green: '#4CAF50' } },
            boxShadow: { brand: '0 10px 30px -12px rgba(14,60,117,.25)' }
          }
        }
      }
    </script>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <header class="bg-white border-b border-gray-200">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <a href="index.html" class="text-brand-blue hover:underline">← Back to Home</a>
          <div class="inline-flex rounded-lg border border-gray-300 overflow-hidden" role="group" aria-label="Language toggle">
            <button id="btn-en" class="lang-btn lang-active" data-setlang="en" aria-pressed="true">EN</button>
            <button id="btn-zh" class="lang-btn" data-setlang="zh" aria-pressed="false">中</button>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 py-12">
      <h1 class="text-3xl sm:text-4xl font-bold tracking-tight mb-8" data-i18n="news.allNews">All News</h1>
      <div id="all-news-container" class="space-y-6"></div>
      
      <!-- Pagination Controls -->
      <div id="pagination-container" class="mt-12 flex flex-col sm:flex-row items-center justify-between gap-4">
        <div id="pagination-info" class="text-sm text-gray-600"></div>
        <div id="pagination-controls" class="flex items-center gap-2"></div>
      </div>
    </main>

    <script src="./main.js?v=3"></script>
    <script>
      async function loadAllNews() {
        try {
          console.log('loadAllNews: Fetching news_data.json...');
          // Add cache-busting parameter to ensure fresh data
          const response = await fetch('news_data.json?v=' + new Date().getTime());
          if (!response.ok) throw new Error('Failed to fetch news');
          const data = await response.json();
          console.log('loadAllNews: Data loaded, items:', data.news ? data.news.length : 0);
          if (data.news && data.news.length > 0) {
            console.log('loadAllNews: First item date:', data.news[0].date);
            console.log('loadAllNews: First item title:', data.news[0].title_en);
          }
          renderAllNews(data.news);
        } catch (error) {
          console.error('Error loading news:', error);
        }
      }

      // Pagination variables
      let allNewsItems = [];
      let currentPage = 1;
      const itemsPerPage = 6;

      function renderAllNews(newsItems) {
        const container = document.getElementById('all-news-container');
        if (!container) {
          console.error('renderAllNews: Container not found');
          return;
        }

        const lang = getCurrentLanguage();
        console.log('renderAllNews: Language:', lang, 'Items:', newsItems.length);
        
        // Sort news by date (newest first)
        allNewsItems = [...newsItems].sort((a, b) => {
          const dateA = new Date(a.date);
          const dateB = new Date(b.date);
          return dateB - dateA; // Descending order (newest first)
        });
        
        console.log('renderAllNews: Sorted items (first 3 dates):', allNewsItems.slice(0, 3).map(item => item.date));
        
        // Render current page
        renderPage(currentPage);
      }

      function renderPage(page) {
        const container = document.getElementById('all-news-container');
        const lang = getCurrentLanguage();
        
        // Calculate pagination
        const totalPages = Math.ceil(allNewsItems.length / itemsPerPage);
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageItems = allNewsItems.slice(startIndex, endIndex);
        
        // Render news items for current page
        container.innerHTML = pageItems.map(item => {
          const date = lang === 'zh' ? item.date_zh : item.date;
          const title = lang === 'zh' ? item.title_zh : item.title_en;
          const summary = lang === 'zh' ? item.summary_zh : item.summary_en;
          const link = lang === 'zh' ? (item.link_zh || item.link) : item.link;
          const readMore = lang === 'zh' ? '阅读更多 →' : 'Read More →';
          
          return `
            <article class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow">
              <div class="text-sm text-gray-500 mb-2">${date}</div>
              <h2 class="text-xl font-bold text-gray-900 mb-3">${title}</h2>
              <p class="text-gray-700 mb-4">${summary}</p>
              <a href="${link}" class="inline-flex items-center text-brand-blue hover:text-brand-blue/80 font-semibold">
                ${readMore}
              </a>
            </article>
          `;
        }).join('');
        
        // Render pagination controls
        renderPaginationControls(page, totalPages);
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function renderPaginationControls(currentPage, totalPages) {
        const infoContainer = document.getElementById('pagination-info');
        const controlsContainer = document.getElementById('pagination-controls');
        const lang = getCurrentLanguage();
        
        if (totalPages <= 1) {
          infoContainer.innerHTML = '';
          controlsContainer.innerHTML = '';
          return;
        }
        
        // Pagination info
        const startItem = (currentPage - 1) * itemsPerPage + 1;
        const endItem = Math.min(currentPage * itemsPerPage, allNewsItems.length);
        const infoText = lang === 'zh' 
          ? `显示 ${startItem}-${endItem} 条，共 ${allNewsItems.length} 条`
          : `Showing ${startItem}-${endItem} of ${allNewsItems.length} news items`;
        infoContainer.textContent = infoText;
        
        // Pagination controls
        let controlsHTML = '';
        
        // Previous button
        const prevText = lang === 'zh' ? '上一页' : 'Previous';
        const nextText = lang === 'zh' ? '下一页' : 'Next';
        
        controlsHTML += `
          <button 
            onclick="changePage(${currentPage - 1})" 
            ${currentPage === 1 ? 'disabled' : ''}
            class="px-4 py-2 text-sm font-medium rounded-md border ${
              currentPage === 1 
                ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                : 'bg-white text-gray-700 hover:bg-gray-50 border-gray-300'
            }">
            ${prevText}
          </button>
        `;
        
        // Page numbers
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage < maxVisiblePages - 1) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        if (startPage > 1) {
          controlsHTML += `
            <button onclick="changePage(1)" class="px-4 py-2 text-sm font-medium rounded-md border bg-white text-gray-700 hover:bg-gray-50 border-gray-300">
              1
            </button>
          `;
          if (startPage > 2) {
            controlsHTML += '<span class="px-2 text-gray-500">...</span>';
          }
        }
        
        for (let i = startPage; i <= endPage; i++) {
          controlsHTML += `
            <button 
              onclick="changePage(${i})" 
              class="px-4 py-2 text-sm font-medium rounded-md border ${
                i === currentPage 
                  ? 'bg-brand-blue text-white border-brand-blue' 
                  : 'bg-white text-gray-700 hover:bg-gray-50 border-gray-300'
              }">
              ${i}
            </button>
          `;
        }
        
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            controlsHTML += '<span class="px-2 text-gray-500">...</span>';
          }
          controlsHTML += `
            <button onclick="changePage(${totalPages})" class="px-4 py-2 text-sm font-medium rounded-md border bg-white text-gray-700 hover:bg-gray-50 border-gray-300">
              ${totalPages}
            </button>
          `;
        }
        
        // Next button
        controlsHTML += `
          <button 
            onclick="changePage(${currentPage + 1})" 
            ${currentPage === totalPages ? 'disabled' : ''}
            class="px-4 py-2 text-sm font-medium rounded-md border ${
              currentPage === totalPages 
                ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                : 'bg-white text-gray-700 hover:bg-gray-50 border-gray-300'
            }">
            ${nextText}
          </button>
        `;
        
        controlsContainer.innerHTML = controlsHTML;
      }

      function changePage(page) {
        const totalPages = Math.ceil(allNewsItems.length / itemsPerPage);
        if (page < 1 || page > totalPages) return;
        currentPage = page;
        renderPage(currentPage);
      }

      // Reload news when language changes
      const originalApplyLang = applyLang;
      applyLang = function(lang) {
        originalApplyLang(lang);
        if (document.getElementById('all-news-container')) {
          currentPage = 1; // Reset to first page
          if (allNewsItems.length > 0) {
            renderPage(currentPage);
          } else {
            loadAllNews();
          }
        }
      };

      // Initialize
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          init();
          loadAllNews();
        });
      } else {
        init();
        loadAllNews();
      }
    </script>
  </body>
</html>


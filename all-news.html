<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>All News - ABC Chemical</title>
    <meta name="description" content="All news and updates from ABC Chemical Co., Ltd." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Suppress Tailwind CDN warning BEFORE loading Tailwind -->
    <script>
      (function() {
        const originalWarn = console.warn;
        console.warn = function(...args) {
          const msg = args[0];
          // Suppress Tailwind CDN production warnings
          if (msg && typeof msg === 'string') {
            if (msg.includes('cdn.tailwindcss.com') || 
                msg.includes('should not be used in production') ||
                msg.includes('Tailwind CSS')) {
              return; // Suppress warning
            }
          }
          originalWarn.apply(console, args);
        };
      })();
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
      // Tailwind config
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter','ui-sans-serif','system-ui','Arial'] },
            colors: { brand: { blue: '#0E3C75', green: '#4CAF50' } },
            boxShadow: { brand: '0 10px 30px -12px rgba(14,60,117,.25)' }
          }
        }
      }
    </script>
    
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="assets/css/mobile-fix.css?v=2">
</head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-20">
          <!-- Back to Home with Logo -->
          <a href="index.html" class="flex items-center gap-3 text-brand-blue hover:text-brand-blue/80 transition-colors group">
            <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            <span class="text-base font-semibold">Back to Home</span>
          </a>
          
          <!-- Language Toggle -->
          <div class="inline-flex rounded-lg border border-gray-300 overflow-hidden" role="group" aria-label="Language toggle">
            <button id="btn-en" class="lang-btn lang-active" data-setlang="en" aria-pressed="true">EN</button>
            <button id="btn-zh" class="lang-btn" data-setlang="zh" aria-pressed="false">中</button>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 py-16">
      <!-- Page Header -->
      <div class="mb-12">
        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight text-gray-900 mb-4" data-i18n="news.allNews">All News</h1>
        <p class="text-lg text-gray-600 max-w-2xl">Stay updated with the latest news, announcements, and developments from ABC Chemical Co., Ltd.</p>
      </div>
      
      <!-- News Container -->
      <div id="all-news-container" class="space-y-8"></div>
      
      <!-- Pagination Controls -->
      <div id="pagination-container" class="mt-16 flex flex-col sm:flex-row items-center justify-between gap-4 pt-8 border-t border-gray-200">
        <div id="pagination-info" class="text-sm font-medium text-gray-600"></div>
        <div id="pagination-controls" class="flex items-center gap-2 flex-wrap justify-center"></div>
      </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 mt-20">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
          <div class="flex items-center gap-3">
            <img src="assets/images/abc-logo.png" alt="ABC Chemical" class="h-8 w-auto opacity-80" />
            <span class="text-sm">ABC Chemical Co., Ltd.</span>
          </div>
          <div class="flex items-center gap-6 text-sm">
            <a href="index.html" class="hover:text-white transition">Home</a>
            <a href="#" class="hover:text-white transition">Privacy</a>
            <a href="#" class="hover:text-white transition">Terms</a>
          </div>
          <div class="text-sm text-gray-500">
            <span data-i18n="footer.c">©</span> 2025 ABC Chemical Co., Ltd.
          </div>
        </div>
      </div>
    </footer>

    <script src="./main.js?v=3"></script>
    <script>
      async function loadAllNews() {
        try {
          console.log('loadAllNews: Fetching news_data.json...');
          // Add cache-busting parameter to ensure fresh data
          const response = await fetch('news_data.json?v=' + new Date().getTime());
          if (!response.ok) throw new Error('Failed to fetch news');
          const data = await response.json();
          console.log('loadAllNews: Data loaded, items:', data.news ? data.news.length : 0);
          if (data.news && data.news.length > 0) {
            console.log('loadAllNews: First item date:', data.news[0].date);
            console.log('loadAllNews: First item title:', data.news[0].title_en);
          }
          renderAllNews(data.news);
        } catch (error) {
          console.error('Error loading news:', error);
        }
      }

      // Pagination variables
      let allNewsItems = [];
      let currentPage = 1;
      const itemsPerPage = 6;

      function renderAllNews(newsItems) {
        const container = document.getElementById('all-news-container');
        if (!container) {
          console.error('renderAllNews: Container not found');
          return;
        }

        const lang = getCurrentLanguage();
        console.log('renderAllNews: Language:', lang, 'Items:', newsItems.length);
        
        // Sort news by date (newest first)
        allNewsItems = [...newsItems].sort((a, b) => {
          const dateA = new Date(a.date);
          const dateB = new Date(b.date);
          return dateB - dateA; // Descending order (newest first)
        });
        
        console.log('renderAllNews: Sorted items (first 3 dates):', allNewsItems.slice(0, 3).map(item => item.date));
        
        // Render current page
        renderPage(currentPage);
      }

      function renderPage(page) {
        const container = document.getElementById('all-news-container');
        const lang = getCurrentLanguage();
        
        // Calculate pagination
        const totalPages = Math.ceil(allNewsItems.length / itemsPerPage);
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageItems = allNewsItems.slice(startIndex, endIndex);
        
        // Render news items for current page
        container.innerHTML = pageItems.map(item => {
          const date = lang === 'zh' ? item.date_zh : item.date;
          const title = lang === 'zh' ? item.title_zh : item.title_en;
          const summary = lang === 'zh' ? item.summary_zh : item.summary_en;
          const link = lang === 'zh' ? (item.link_zh || item.link) : item.link;
          const readMore = lang === 'zh' ? '阅读更多 →' : 'Read More →';
          
          return `
            <article class="group bg-white rounded-xl border border-gray-200 p-8 shadow-sm hover:shadow-xl hover:border-brand-blue/20 transition-all duration-300">
              <div class="flex items-center gap-2 text-sm font-medium text-brand-blue/70 mb-3">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <time datetime="${item.date}">${date}</time>
              </div>
              <h2 class="text-2xl font-bold text-gray-900 mb-4 group-hover:text-brand-blue transition-colors leading-tight">${title}</h2>
              <p class="text-base text-gray-600 leading-relaxed mb-6">${summary}</p>
              <a href="${link}" class="inline-flex items-center gap-2 text-brand-blue hover:text-brand-blue/80 font-semibold text-sm transition-all group-hover:gap-3">
                <span>${readMore}</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
              </a>
            </article>
          `;
        }).join('');
        
        // Render pagination controls
        renderPaginationControls(page, totalPages);
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function renderPaginationControls(currentPage, totalPages) {
        const infoContainer = document.getElementById('pagination-info');
        const controlsContainer = document.getElementById('pagination-controls');
        const lang = getCurrentLanguage();
        
        if (totalPages <= 1) {
          infoContainer.innerHTML = '';
          controlsContainer.innerHTML = '';
          return;
        }
        
        // Pagination info
        const startItem = (currentPage - 1) * itemsPerPage + 1;
        const endItem = Math.min(currentPage * itemsPerPage, allNewsItems.length);
        const infoText = lang === 'zh' 
          ? `显示 ${startItem}-${endItem} 条，共 ${allNewsItems.length} 条`
          : `Showing ${startItem}-${endItem} of ${allNewsItems.length} news items`;
        infoContainer.textContent = infoText;
        
        // Pagination controls
        let controlsHTML = '';
        
        // Previous button
        const prevText = lang === 'zh' ? '上一页' : 'Previous';
        const nextText = lang === 'zh' ? '下一页' : 'Next';
        
        controlsHTML += `
          <button 
            onclick="changePage(${currentPage - 1})" 
            ${currentPage === 1 ? 'disabled' : ''}
            class="px-5 py-2.5 text-sm font-semibold rounded-lg border transition-all ${
              currentPage === 1 
                ? 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' 
                : 'bg-white text-gray-700 hover:bg-brand-blue hover:text-white hover:border-brand-blue border-gray-300 shadow-sm hover:shadow-md'
            }">
            ${prevText}
          </button>
        `;
        
        // Page numbers
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage < maxVisiblePages - 1) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        if (startPage > 1) {
          controlsHTML += `
            <button onclick="changePage(1)" class="px-4 py-2.5 text-sm font-semibold rounded-lg border bg-white text-gray-700 hover:bg-brand-blue hover:text-white hover:border-brand-blue border-gray-300 shadow-sm hover:shadow-md transition-all">
              1
            </button>
          `;
          if (startPage > 2) {
            controlsHTML += '<span class="px-2 text-gray-400 font-semibold">...</span>';
          }
        }
        
        for (let i = startPage; i <= endPage; i++) {
          controlsHTML += `
            <button 
              onclick="changePage(${i})" 
              class="px-4 py-2.5 text-sm font-semibold rounded-lg border transition-all ${
                i === currentPage 
                  ? 'bg-brand-blue text-white border-brand-blue shadow-md scale-105' 
                  : 'bg-white text-gray-700 hover:bg-brand-blue hover:text-white hover:border-brand-blue border-gray-300 shadow-sm hover:shadow-md'
              }">
              ${i}
            </button>
          `;
        }
        
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            controlsHTML += '<span class="px-2 text-gray-400 font-semibold">...</span>';
          }
          controlsHTML += `
            <button onclick="changePage(${totalPages})" class="px-4 py-2.5 text-sm font-semibold rounded-lg border bg-white text-gray-700 hover:bg-brand-blue hover:text-white hover:border-brand-blue border-gray-300 shadow-sm hover:shadow-md transition-all">
              ${totalPages}
            </button>
          `;
        }
        
        // Next button
        controlsHTML += `
          <button 
            onclick="changePage(${currentPage + 1})" 
            ${currentPage === totalPages ? 'disabled' : ''}
            class="px-5 py-2.5 text-sm font-semibold rounded-lg border transition-all ${
              currentPage === totalPages 
                ? 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' 
                : 'bg-white text-gray-700 hover:bg-brand-blue hover:text-white hover:border-brand-blue border-gray-300 shadow-sm hover:shadow-md'
            }">
            ${nextText}
          </button>
        `;
        
        controlsContainer.innerHTML = controlsHTML;
      }

      function changePage(page) {
        const totalPages = Math.ceil(allNewsItems.length / itemsPerPage);
        if (page < 1 || page > totalPages) return;
        currentPage = page;
        renderPage(currentPage);
      }

      // Reload news when language changes
      const originalApplyLang = applyLang;
      applyLang = function(lang) {
        originalApplyLang(lang);
        if (document.getElementById('all-news-container')) {
          currentPage = 1; // Reset to first page
          if (allNewsItems.length > 0) {
            renderPage(currentPage);
          } else {
          loadAllNews();
          }
        }
      };

      // Initialize
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          init();
          loadAllNews();
        });
      } else {
        init();
        loadAllNews();
      }
    </script>
    <script src="assets/js/mobile-fix.js?v=2"></script>
</body>
</html>

